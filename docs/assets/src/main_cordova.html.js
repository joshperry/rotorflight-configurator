import"../modulepreload-polyfill.js";import{a as i}from"../localization.js";const w=72,s={chromeVersion:"",majorChromeVersion:0,appsId:{androidWebview:"com.android.webview",googleWebview:"com.google.android.webview",chrome:"com.android.chrome"},apps:{"com.android.webview":{},"com.google.android.webview":{name:"Android System WebView",displayName:"Google Android Webview"},"com.android.chrome":{name:"Google Chrome",displayName:"Chrome"}},matchingVersion:0,usedApp:null,uptodateApps:[],htmlElements:{webview_step_msg:"#webview_step_msg",webview_step_btn1:"#webview_step_btn1",webview_step_btn2:"#webview_step_btn2"},advices:{installGoogleAndroidWebview:function(p){$(s.htmlElements.webview_step_msg).html(i.getMessage("cordovaWebviewInstall",{app:s.apps[s.appsId.googleWebview].name})),$("#webview_step_btn1").text(i.getMessage("cordovaWebviewInstallBtn")).attr("app_id",s.appsId.googleWebview),p()},updateGoogleAndroidWebview:function(p){$(s.htmlElements.webview_step_msg).html(i.getMessage("cordovaWebviewUpdate",{app:s.apps[s.appsId.googleWebview].name})),$(s.htmlElements.webview_step_btn1).text(i.getMessage("cordovaWebviewUpdateBtn")).attr("app_id",s.appsId.googleWebview),p()},updateAndroidChrome:function(p){$(s.htmlElements.webview_step_msg).html(i.getMessage("cordovaWebviewUpdate",{app:s.apps[s.appsId.chrome].name})),$(s.htmlElements.webview_step_btn1).text(i.getMessage("cordovaWebviewUpdateBtn")).attr("app_id",s.appsId.chrome),p()},uninstallGoogleAndroidWebview:function(p){$(s.htmlElements.webview_step_msg).html(i.getMessage("cordovaWebviewUninstall",{app:s.apps[s.appsId.googleWebview].name})),$(s.htmlElements.webview_step_btn1).text(i.getMessage("cordovaWebviewUninstallBtn1")).attr("app_id",s.appsId.googleWebview),$(s.htmlElements.webview_step_btn2).text(i.getMessage("cordovaWebviewUninstallBtn2")).attr("app_id",s.appsId.googleWebview).show(),p()},selectWebview:function(p,e){let n;p===s.appsId.googleWebview?n=s.apps[s.appsId.googleWebview].displayName:p===s.appsId.chrome&&(n=s.apps[s.appsId.chrome].displayName),$(s.htmlElements.webview_step_msg).html(i.getMessage("cordovaWebviewEnable",{app:n})),$(s.htmlElements.webview_step_btn1).hide(),$(s.htmlElements.webview_step_btn2).text(i.getMessage("cordovaWebviewEnableBtn")).show(),e()}},getAdvice1:function(p){const e=this;e.usedApp===s.appsId.googleWebview?e.advices.updateGoogleAndroidWebview(p):e.usedApp===s.appsId.chrome&&e.advices.updateAndroidChrome(p)},getAdvice2:function(p){const e=this;e.uptodateApps.length>0?e.advices.selectWebview(e.uptodateApps[0],p):e.apps[s.appsId.googleWebview].installed&&e.apps[s.appsId.googleWebview].enabled&&e.apps[s.appsId.chrome].installed&&e.apps[s.appsId.chrome].enabled?e.advices.uninstallGoogleAndroidWebview(p):!(e.apps[s.appsId.googleWebview].installed&&e.apps[s.appsId.googleWebview].enabled)&&!(e.apps[s.appsId.chrome].installed&&e.apps[s.appsId.chrome].enabled)?e.advices.installGoogleAndroidWebview(p):e.getAdvice3(p)},getAdvice3:function(p){const e=this;e.apps[s.appsId.googleWebview].installed&&e.apps[s.appsId.googleWebview].enabled&&!e.apps[s.appsId.googleWebview].uptodate?e.advices.updateGoogleAndroidWebview(p):e.apps[s.appsId.chrome].installed&&e.apps[s.appsId.chrome].enabled&&!e.apps[s.appsId.chrome].uptodate&&e.advices.updateAndroidChrome(p)},getAdvice:function(p){const e=this;e.usedApp&&e.usedApp!==s.appsId.androidWebview?this.getAdvice1(p):this.getAdvice2(p)},tryToFindUsedApp:function(p){const e=this,n=Object.keys(e.apps);for(let a=0;a<n.length;a++){const l=n[a];e.matchingVersion===1&&e.apps[l].used==="could"&&(e.apps[l].used="yes",e.usedApp=l,$(`li[app_id='${l}']`).append(` (<span style="color: green">${i.getMessage("cordovaWebviewUsed")}</span>)`)),a===n.length-1&&p()}},checkInstalledApps:function(p){const e=this,n=Object.keys(e.apps);let a=0;function l(o,t){appAvailability.check(o,function(d){g(d,o,t)},function(){m(o,t)})}function v(o){o===n.length-1&&(a===0&&$("#webview_apps").append('<li i18n="cordovaNoWebview" style="color: red"></li>'),i.localizePage(),console.log("callback"),p())}function g(o,t,d){a++,e.apps[t].installed=!0,e.apps[t].enabled=o.enabled,e.apps[t].version=o.version,e.apps[t].majorVersion=parseInt(o.version.split(".")[0]),e.chromeVersion===e.apps[t].version?(e.apps[t].used="could",e.matchingVersion++):e.apps[t].used="no";let c;e.apps[t].majorVersion>=w?(c="green",e.apps[t].uptodate=!0,e.uptodateApps.push(t)):(c="red",e.apps[t].uptodate=!1);let r=`<li app_id="${t}">${t} (<span style="color: ${c}">${e.apps[t].version}</span>)`;e.apps[t].enabled||(r+=' (<span i18n="portsTelemetryDisabled"></span>)'),r+="</li>",$("#webview_apps").append(r),v(d)}function m(o,t){e.apps[o].installed=!1,v(t)}for(let o=0;o<n.length;o++){const t=n[o];l(t,o)}},exec:function(){const p=this;$("#webview_troubleshooting").hide(),$("#loading").show(),p.chromeVersion=window.navigator.appVersion.replace(/.*Chrome\/([0-9.]*).*/,"$1"),p.majorChromeVersion=p.chromeVersion.split(".")[0],p.majorChromeVersion>=w?(navigator.splashscreen.show(),document.location.href="/index.html"):(navigator.splashscreen.hide(),p.checkInstalledApps(function(){p.tryToFindUsedApp(function(){p.getAdvice(function(){$("#loading").hide(),$("#webview_troubleshooting").show()})})}))}},b={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){i.init().then(function(){i.localizePage(),s.exec()})}};b.initialize();$(s.htmlElements.webview_step_btn1).on("click",function(){const p=$(s.htmlElements.webview_step_btn1).attr("app_id");cordova.plugins.market.open(p)});$(s.htmlElements.webview_step_btn2).on("click",function(){if($(s.htmlElements.webview_step_btn2).attr("app_id")!==void 0){const p=$(s.htmlElements.webview_step_btn2).attr("app_id");window.cordova.plugins.settings.open(["application_details",!1,p])}else window.cordova.plugins.settings.open("settings")});
